using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace ConsoleApp3
{
    namespace GameRatingSystem
    {
       
        public abstract class GameParticipant
        {
            public string Name { get; protected set; }
            public int Id { get; protected set; }

            protected GameParticipant(string name, int id)
            {
                if (string.IsNullOrWhiteSpace(name))
                    throw new ArgumentException("Имя не может быть пустым");

                Name = name;
                Id = id;
            }

            public abstract void DisplayInfo();
        }

         
        public class Player : GameParticipant, IComparable<Player>
        {
            private int score;

            public int Score
            {
                get { return score; }
                set
                {
                    if (value < 0)
                        throw new ArgumentException("Счет не может быть отрицательным");
                    score = value;
                }
            }

            public DateTime RegistrationDate { get; private set; }

           
            public Player(string name, int id, int initialScore = 0)
                : base(name, id)
            {
                Score = initialScore;
                RegistrationDate = DateTime.Now;
            }

            
            public void IncreaseScore(int points)
            {
                if (points <= 0)
                    throw new ArgumentException("Очки должны быть положительными");

                Score += points;
            }

           
            public void DecreaseScore(int points)
            {
                if (points <= 0)
                    throw new ArgumentException("Очки должны быть положительными");

                Score = Math.Max(0, Score - points);
            }

            
            public override void DisplayInfo()
            {
                Console.WriteLine($"Игрок: {Name} (ID: {Id})");
                Console.WriteLine($"  Счет: {Score}");
                Console.WriteLine($"  Зарегистрирован: {RegistrationDate:dd.MM.yyyy}");
            }

            
            public int CompareTo(Player other)
            {
                if (other == null) return 1;
                return other.Score.CompareTo(this.Score); // Сортировка по убыванию
            }

            public override string ToString()
            {
                return $"{Name} - {Score} очков";
            }
        }

        
        public interface IRatingTable
        {
            void AddPlayer(Player player);
            bool RemovePlayer(int playerId);
            List<Player> GetTopPlayers(int count);
            Player GetPlayerById(int playerId);
            void DisplayTable();
        }

        
        public class RatingTable : IRatingTable
        {
            private List<Player> players;
            private int nextPlayerId;

            public RatingTable()
            {
                players = new List<Player>();
                nextPlayerId = 1;
            }

          
            public void AddPlayer(Player player)
            {
                if (player == null)
                    throw new ArgumentNullException(nameof(player), "Игрок не может быть null");

              
                foreach (var p in players)
                {
                    if (p.Id == player.Id)
                    {
                        throw new InvalidOperationException($"Игрок с ID {player.Id} уже существует");
                    }
                }

                players.Add(player);
                Console.WriteLine($"Игрок {player.Name} добавлен в таблицу");
            }

          
            public Player CreatePlayer(string name, int initialScore = 0)
            {
                Player player = new Player(name, nextPlayerId, initialScore);
                nextPlayerId++;
                AddPlayer(player);
                return player;
            }

            
            public bool RemovePlayer(int playerId)
            {
                for (int i = 0; i < players.Count; i++)
                {
                    if (players[i].Id == playerId)
                    {
                        string playerName = players[i].Name;
                        players.RemoveAt(i);
                        Console.WriteLine($"Игрок {playerName} (ID: {playerId}) удален из таблицы");
                        return true;
                    }
                }

                Console.WriteLine($"Игрок с ID {playerId} не найден");
                return false;
            }

         
            public List<Player> GetTopPlayers(int count)
            {
                if (count <= 0)
                    throw new ArgumentException("Количество должно быть положительным");

                if (count > players.Count)
                    count = players.Count;

               
                players.Sort();

                List<Player> topPlayers = new List<Player>();
                for (int i = 0; i < count; i++)
                {
                    topPlayers.Add(players[i]);
                }

                return topPlayers;
            }

          
            public Player GetPlayerById(int playerId)
            {
                foreach (var player in players)
                {
                    if (player.Id == playerId)
                        return player;
                }
                return null;
            }


            public int GetPlayerPosition(int playerId)
            {
                players.Sort();

                for (int i = 0; i < players.Count; i++)
                {
                    if (players[i].Id == playerId)
                        return i + 1;
                }

                return -1;
            }


            public void DisplayTable()
            {
                if (players.Count == 0)
                {
                    Console.WriteLine("Рейтинговая таблица пуста");
                    return;
                }

                Console.WriteLine("\n=== РЕЙТИНГОВАЯ ТАБЛИЦА ===");
                players.Sort();

                for (int i = 0; i < players.Count; i++)
                {
                    Console.WriteLine($"{i + 1}. {players[i]}");
                }
            }


            public void DisplayPlayersInfo()
            {
                Console.WriteLine("\n=== ИНФОРМАЦИЯ ОБ ИГРОКАХ ===");
                foreach (var player in players)
                {
                    player.DisplayInfo();
                    Console.WriteLine();
                }
            }
        }


        public class GameManager
        {
            private RatingTable ratingTable;

            public GameManager()
            {
                ratingTable = new RatingTable();
            }

            public void RunDemo()
            {
                try
                {
                    Console.WriteLine("=== ДЕМО РЕЙТИНГОВОЙ СИСТЕМЫ ===\n");


                    Console.WriteLine("Создание игроков:");
                    Player player1 = ratingTable.CreatePlayer("Алексей", 1500);
                    Player player2 = ratingTable.CreatePlayer("Мария", 1800);
                    Player player3 = ratingTable.CreatePlayer("Иван", 1200);
                    Player player4 = ratingTable.CreatePlayer("Ольга", 2000);
                    Player player5 = ratingTable.CreatePlayer("Дмитрий", 1600);


                    Console.WriteLine("\nИзменение счетов:");
                    player1.IncreaseScore(200);
                    player3.IncreaseScore(100);
                    player5.DecreaseScore(300);


                    Console.WriteLine("\nТОП-3 ИГРОКА:");
                    List<Player> top3 = ratingTable.GetTopPlayers(3);
                    for (int i = 0; i < top3.Count; i++)
                    {
                        Console.WriteLine($"{i + 1}. {top3[i]}");
                    }


                    Console.WriteLine("\nПОЗИЦИИ ИГРОКОВ:");
                    Console.WriteLine($"Позиция Алексея: {ratingTable.GetPlayerPosition(player1.Id)}");
                    Console.WriteLine($"Позиция Ольги: {ratingTable.GetPlayerPosition(player4.Id)}");


                    ratingTable.DisplayTable();


                    ratingTable.DisplayPlayersInfo();


                    Console.WriteLine("\nУдаление игрока:");
                    ratingTable.RemovePlayer(player3.Id);


                    ratingTable.DisplayTable();
                }
                catch (Exception ex)
                {
                    Console.WriteLine($"Ошибка: {ex.Message}");
                }
            }
        }

        class Program
        {
            static void Main(string[] args)
            {
                GameManager gameManager = new GameManager();
                gameManager.RunDemo();

                Console.WriteLine("\nНажмите любую клавишу для выхода...");
                Console.ReadKey();
            }
        }
    }
}
